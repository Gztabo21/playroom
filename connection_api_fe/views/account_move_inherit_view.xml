<?xml version="1.0" encoding="UTF-8"?>
<odoo>

	<record id="account_move_inherit_view_form" model="ir.ui.view">
		<field name="name">account.move.form.inherit</field>
		<field name="model">account.move</field>
		<field name="inherit_id" ref="account.view_move_form"></field>
		<field name="arch" type="xml">
			<field name="state" position="before">
				<field name="state_dian" invisible="1" />
				<!-- <button name="remove_files_out_refund" string="Remove" type="object" class="oe_highlight"/> -->
				<!-- <button name="return_invoice_origin_all_invoice" string="Invoice Origin" type="object" class="oe_highlight"/> -->

				<button style="background: #f34e4e; border: black;" name="validate_dian" states="open,paid" string="Validar DIAN" type="object" attrs="{'invisible' : ['|', ('state', 'in', ['draft', 'cancel']), ('state_dian', '=', 'exitoso')]}" groups="account.group_account_invoice" class="oe_highlight" />
			</field>

			<xpath expr="//field[@name='amount_by_group']" position="after">
				<field name="amount_discount" attrs="{'invisible':[('amount_discount','=',0)]}" />
			</xpath>

			<xpath expr="//field[@name='partner_bank_id']" position="after">
				<field name="text_amount" readonly="1" />
			</xpath>

			<xpath expr="//form/sheet/group/group[2]//field[2]" position="after">
				<field name="guide_number" />
			</xpath>

			<xpath expr="//page[@name='other_info']//group[@id='other_tab_group']//group[@name='sale_info_group']//field[@name='ref']" position="after">
				<field name="invoice_origin" />
			</xpath>

			<xpath expr="//notebook" position="inside">
				<page name="dian" string="DIAN">
					<field name="xml_file_name" invisible="1" />
					<field name="zip_file_name" invisible="1" />
					<field name="pdf_file_name" invisible="1" />
					<!-- <div class="alert alert-info" role="alert" style="margin-top:10px;" attrs="{'invisible': [('diancode_id','!=',False)]}"> -->
					<div class="alert alert-info" role="alert" style="margin-top:10px;" attrs="{'invisible' : [('state_dian', '=', 'exitoso')]}">
						Presione en el boton
						<b>Validar DIAN</b>
						para enviar la factura
					</div>

					<group>
						<field name="cufe" />
					</group>

					<group>
						<field name="notes_fe" placeholder="Notas para la Facturación Electrónica" />
					</group>

					<group>
						<h3>
							<field name="state_dian" />
						</h3>
					</group>
					<group col="4">
						<field name="payment_method_dian_id" />
						<field name="type_note_credit" />
					</group>
					<group>
						<field name="QR_code" widget="image" />
					</group>

					<group col="4">
						<field name="xml_file" filename="xml_file_name" widget="binary" />
						<field name="zip_file" filename="zip_file_name" widget="binary" />
						<field name="pdf_file" filename="pdf_file_name" widget="binary" />
					</group>

					<group>
						<field name="xml_response_dian" />
					</group>

					<group>
						<field name="response_api" />
					</group>
					<button type="object" name="action_invoice_dian_resend" string="Reenviar el documento DIAN por email" class="btn-primary" />
				</page>
				<page name="json_fe" string="JSON FE">
					<button style="background: #f34e4e; border: black;" name="show_json_data_fe" string="Mostrar JSON" type="object" groups="connection_api_fe.group_show_json" class="oe_highlight" />

					<div class="alert alert-info" role="alert" style="margin-top:10px;">
						Pulse sobre el botón para consultar el json de la factura actual.
					</div>


					<group>
						<field name="xml_response" nolabel="1" />
					</group>


				</page>
			</xpath>

		</field>
	</record>

	<record id="account_move_inherit_view_tree" model="ir.ui.view">
		<field name="name">account.move.tree.inherit</field>
		<field name="model">account.move</field>
		<field name="inherit_id" ref="account.view_out_invoice_tree"></field>
		<field name="arch" type="xml">
			<field name="state" position="after">
				<field name="state_dian" string="Estado DIAN" />
			</field>
		</field>
	</record>

	<record id="action_download_pdf_fe" model="ir.actions.server">
		<field name="name">Imprimir FE</field>
		<field name="model_id" ref="account.model_account_move" />
		<field name="groups_id" eval="[(4, ref('account.group_account_invoice'))]" />
		<field name="binding_model_id" ref="account.model_account_move" />
		<field name="state">code</field>
		<field name="binding_view_types">form</field>
		<field name="code">
			action = record.download_pdf()
		</field>
	</record>

</odoo>