<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="o_website_sale_cart_rightfit" inherit_id="website_sale.cart" customize_show="True" active="True" name="Multi Carts">
            <xpath expr="//div[hasclass('oe_cart')]" position="inside">
                <div class="row">
                    <div class="col-lg-12 mb16">
                        <a class="btn btn-success mr8" data-toggle="modal" data-target="#save_cart_btn">Save Cart</a>
                        <a href="/my/carts" class="btn btn-success pull-right mr8">View Saved Carts</a>
                        <div class="modal fade" id="save_cart_btn" role="dialog">
                            <div class="modal-dialog modal-md">
                                <div class="modal-content">
                                    <form action="/shop/multicart/add" method="get">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                        <header class="modal-header">
                                            <h4 class="modal-title">Save Cart</h4>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">×</button>
                                        </header>
                                        <main class="modal-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label for="text">Cart Name:</label>
                                                        <input type="text" class="form-control" id="cart_name" placeholder="Cart Name" name="cart_name" required="True" />
                                                    </div>
                                                </div>
                                            </div>
                                        </main>
                                        <footer class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Save</button>
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        </footer>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix" />
                    </div>
                </div>
            </xpath>
        </template>
        <template id="portal_my_save_cart_menu" name="Portal layout : Saved cart entries" inherit_id="portal.portal_breadcrumbs" priority="30">
            <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
                <li t-if="page_name == 'carts'" t-attf-class="breadcrumb-item #{'active ' if not carts else ''}">
                    <a t-if="carts" t-attf-href="/my/carts?{{ keep_query() }}">Saved Cart</a>
                    <t t-else="">Saved Cart</t>
                </li>
                <li t-if="carts" class="breadcrumb-item active">
                    <t t-esc="carts.name" />
                </li>
            </xpath>
        </template>
        <template id="portal_my_save_cart_menu_entries" name="Portal My Home : Saved cart entries" inherit_id="portal.portal_my_home" priority="30">
            <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
                <t t-if="carts_count" t-call="portal.portal_docs_entry">
                    <t t-set="title">Saved Cart</t>
                    <t t-set="url" t-value="'/my/carts'" />
                    <t t-set="count" t-value="carts_count" />
                </t>
            </xpath>
        </template>
        <template id="portal_my_save_cart" name="My Saved Cart">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True" />
                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Saved Cart</t>
                </t>
                <t t-if="not save_carts">
                    <div class="alert alert-warning mt8" role="alert">
                        There are currently no saved cart for your account.
                    </div>
                </t>
                <t t-if="save_carts" t-call="portal.portal_table">
                    <thead>
                        <tr class="active">
                            <th>Cart Name #</th>
                            <th>Item In cart</th>
                            <th>Total Amount</th>
                            <th>Date Saved</th>
                            <th>View Cart</th>
                            <th>Move to Cart</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="save_carts" t-as="cart">
                            <td>
                                <a t-attf-href="/my/carts/#{cart.id}" t-att-title="cart.name">
                                    <t t-esc="cart.name" />
                                </a>
                            </td>
                            <td>
                                <span t-esc="len(cart.cart_lines)" />
                            </td>
                            <td>
                                <span t-field="cart.amount_total" t-options='{"widget": "monetary", "display_currency": website.get_current_pricelist().currency_id}' />
                            </td>
                            <td>
                                <span t-field="cart.date_order" />
                            </td>
                            <td>
                                <a t-attf-href="/my/carts/#{cart.id}" class="btn btn-info">View cart</a>
                            </td>
                            <td>
                                <button class="btn btn-success sweet-click-move-cart" t-att-data-cart_id='cart.id' data-toggle="modal" t-attf-data-target="#save_cart_move_btn#{cart.id}">
                                    Move To Cart
                                </button>
                            </td>
                            <td>
                                <button class="btn btn-primary sweet-click-rename-cart" t-att-data-cart_id='cart.id' data-toggle="modal" t-attf-data-target="#save_cart_rename_btn#{cart.id}">
                                    <i class="fa fa-edit" />
                                </button>
                            </td>
                            <td>
                                <button class="btn btn-danger sweet-click-delete-cart" t-att-data-cart_id='cart.id'>
                                    <i class="fa fa-trash-o" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </t>
                <t t-foreach="save_carts" t-as="cart">
                    <t t-call="website_save_cart.portal_rename_move_cart" />
                </t>
            </t>
        </template>
        <template id="portal_rename_move_cart">
            <div class="modal fade" t-attf-id="save_cart_rename_btn#{cart.id}" role="dialog">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <form action="/shop/multicart/rename" method="get">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                            <header class="modal-header">
                                <h4 class="modal-title">Rename Cart</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">×</button>
                            </header>
                            <main class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="text">New Cart Name:</label>
                                            <input type="hidden" name="cart_id" t-att-value="cart.id" />
                                            <input type="text" class="form-control" id="cart_name" placeholder="Cart Name" name="cart_name" required="True" />
                                        </div>
                                    </div>
                                </div>
                            </main>
                            <footer class="modal-footer">
                                <button type="submit" class="btn btn-primary">Save</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </footer>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal fade" t-attf-id="save_cart_move_btn#{cart.id}" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <header class="modal-header">
                            <h4 class="modal-title">Move Cart</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">×</button>
                        </header>
                        <div class="modal-body">
                            <div class="row">
                                <form action="/shop/multicart/move" method="get">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                    <input type="hidden" name="cart_id" t-att-value="cart.id" />
                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <img src="/website_save_cart/static/src/img/replace_icon.svg" class="img-fluid" />
                                            </div>
                                            <div class="col-md-4">
                                                <img src="/website_save_cart/static/src/img/marge_cart.png" class="img-fluid" />
                                            </div>
                                            <div class="col-md-4">
                                                <h4>
                                                    <b>Select carts which you want to marge?</b>
                                                </h4>
                                                <select class="form-control" name="slected_cart">
                                                    <option></option>
                                                    <t t-foreach="save_carts" t-as="c">
                                                        <option t-att-value="c.id">
                                                            <t t-esc="c.name" />
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 text-center">
                                                <button type="text" class="btn btn-success btn-lg text-center" name="replace_cart" value="True">Replace Cart</button>
                                            </div>
                                            <div class="col-md-4 text-center">
                                                <button type="text" class="btn btn-success btn-lg text-center" name="marge_cart" value="True">Marge Cart</button>
                                            </div>
                                            <div class="col-md-4 text-center">
                                                <button type="text" class="btn btn-success btn-lg text-center" name="current_marge_cart" value="True">Current Cart Marge</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <template id="portal_save_cart_page" name="Save Cart Portal Template">
            <t t-call="portal.portal_layout">
                <div class="container">
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-md-4">
                                    <h4>
                                        <t t-call='portal.record_pager' />
                                        <span t-field="cart.name" />
                                    </h4>
                                </div>
                                <div class="col-md-8 col-sm-8 col-xs-12 text-right">
                                    <button class="btn btn-success sweet-click-move-cart" t-att-data-cart_id='cart.id' data-toggle="modal" t-attf-data-target="#save_cart_move_btn#{cart.id}">
                                        Move To Cart
                                    </button>
                                    <button class="btn btn-primary sweet-click-rename-cart" t-att-data-cart_id='cart.id' data-toggle="modal" t-attf-data-target="#save_cart_rename_btn#{cart.id}">
                                        <i class="fa fa-edit" />
                                    </button>
                                    <button class="btn btn-danger sweet-click-delete-cart" t-att-data-cart_id='cart.id'>
                                        <i class="fa fa-trash-o" />
                                    </button>
                                </div>
                            </div>
                        </div>
                        <t t-call="website_save_cart.portal_rename_move_cart" />
                        <div class="card-body">
                            <div id="informations">
                                <t t-if="error or warning">
                                    <div class="row mr16">
                                        <div t-attf-class="'col-md-12 mr16 ml16 alert alert-dismissable' #{'alert-danger' if error else 'alert-warning'}">
                                            <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a>
                                            <t t-if="error == 'generic'" name="generic">
                                                There was an error processing this page.
                                            </t>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="success and (not error and not warning)">
                                    <div class="row mr16">
                                        <div class="col-md-12 mr16 ml16 alert alert-dismissable alert-success">
                                            <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a>
                                        </div>
                                    </div>
                                </t>
                                <div class="row">
                                    <div class="col-xs-5" name="customer_address">
                                        <strong>Customer Address</strong>
                                        <address t-field="cart.partner_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
                                    </div>
                                </div>
                                <div class="row mt32 mb32">
                                    <div class="col-xs-2" t-if="cart.name">
                                        <strong>Name:</strong>
                                        <p t-field="cart.name" />
                                    </div>
                                    <div class="col-xs-2" t-if="cart.date_order">
                                        <strong>Saved Date:</strong>
                                        <p t-field="cart.date_order" />
                                    </div>
                                    <div class="col-xs-2" t-if="cart.partner_id.ref">
                                        <strong>Customer Code:</strong>
                                        <p t-field="cart.partner_id.ref" />
                                    </div>
                                </div>
                            </div>
                            <table class="table table-sm">
                                <thead class="bg-100">
                                    <tr>
                                        <th>Description</th>
                                        <th class="text-right" width="200">Quantity</th>
                                        <th class="text-right">Unit Price</th>
                                        <th class="text-right">Amount</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody class="sale_tbody">
                                    <tr t-foreach="cart.cart_lines" t-as="l">
                                        <td>
                                            <span t-field="l.product_id.name" />
                                        </td>
                                        <td class="text-right">
                                            <input type="text" t-att-value="l.product_uom_qty" name="product_qty" class="form-control save_carts_line_qty" t-att-data-save-cart-line-id="l.id" />
                                        </td>
                                        <td class="text-right">
                                            <span t-field="l.price_unit" t-options='{"widget": "monetary", "display_currency": website.get_current_pricelist().currency_id}' />
                                        </td>
                                        <td class="text-right" id="subtotal">
                                            <span t-field="l.price_subtotal" t-options='{"widget": "monetary", "display_currency": website.get_current_pricelist().currency_id}' />
                                        </td>
                                        <td class="text-right">
                                            <button class="btn btn-danger btn-xs sweet-click-delete-cart-line" t-att-data-cart_id='cart.id' t-att-data-line_id='l.id'>
                                                <i class="fa fa-trash-o" />
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div id="total" class="row" name="total" style="page-break-inside: avoid;">
                                <div class="col-4 ml-auto">
                                    <table class="table table-sm">
                                        <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                                            <td>
                                                <strong>Total</strong>
                                            </td>
                                            <td class="text-left">
                                                <span t-field="cart.amount_total" t-options='{"widget": "monetary", "display_currency": website.get_current_pricelist().currency_id}' />
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="oe_structure mb32" />
            </t>
        </template>
    </data>
</odoo>